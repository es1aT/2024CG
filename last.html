<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>WebGL 最終作品</title>
  <script src="https://unpkg.com/three@0.137.4/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.137.4/examples/js/controls/OrbitControls.js"></script>
</head>

<body>
  <script>
    // ページの読み込みを待つ
    window.addEventListener('DOMContentLoaded', init);

    var init = function () {
      //サイズ指定
      var width = 800,
        height = 600;

      // レンダラーを作成
      var renderer = new THREE.WebGLRenderer();
      renderer.setSize(width, height);
      document.body.appendChild(renderer.domElement);

      // レンダラー：シャドウを有効にする
      renderer.shadowMap.enabled = true;

      // シーンを作成
      var scene = new THREE.Scene();

      // グリッド追加
      const gridHelper = new THREE.GridHelper(3, 10); // size, step
      scene.add(gridHelper);
      const axisHelper = new THREE.AxisHelper(2); //軸の長さ X：赤、Y：緑、z：青
      scene.add(axisHelper);

      // カメラを作成
      var camera = new THREE.PerspectiveCamera(45, width / height, 1, 1000);
      camera.position.set(7, 5, 5); // 位置を設定
      camera.lookAt(0, 0, 0);

      // カメラコントローラーを作成
      const controls = new THREE.OrbitControls(camera, document.body);

      // 平行光源(色、強さ）主光源
      var directionalLightM = new THREE.DirectionalLight(0xffffff, 1);
      directionalLightM.position.set(0, 10, 0);
      scene.add(directionalLightM);

      // 照明を作成SpotLight(色, 光の強さ, 距離, 照射角, ボケ具合, 減衰率)
      var light = new THREE.SpotLight(0xffffff, 1, 100, Math.PI / 20, 1);
      light.position.set(15, 25, 15);
      light.target.position.set(0, 0, 0);
      // ライトに影を有効にする
      light.castShadow = true;
      light.shadow.mapSize.width = 2048;
      light.shadow.mapSize.height = 2048;
      scene.add(light);

      // 床を作成
      var planeG = new THREE.PlaneGeometry(10, 10, 10, 10);
      var planeM = new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 0, roughness: 0.9, side: THREE.DoubleSide });
      var plane = new THREE.Mesh(planeG, planeM);
      plane.receiveShadow = true; //影がつく
      plane.rotation.set(-Math.PI / 2, 0, 0);
      plane.position.set(0, 0.3, 0);
      scene.add(plane);

      // テクスチャー読み込み
      var textureLoader = new THREE.TextureLoader();
      var texture = textureLoader.load("yuka.png");
      var mat = new THREE.MeshPhongMaterial();
      mat.map = texture;
      // 箱を作成
      var geometry = new THREE.BoxGeometry(3, 1, 3);
      //var material = new THREE.MeshPhongMaterial({ color: 0xffffff });
      //var box = new THREE.Mesh(geometry, material);
      var box = new THREE.Mesh(geometry, mat);
      scene.add(box);

      // 初回実行（描画処理）
      var update = function () {
        renderer.render(scene, camera);
        requestAnimationFrame(update);

        // 車を中心の周りを周回させる
        var time = Date.now() * 0.001;
        car.position.x = Math.cos(time) * 2;
        car.position.z = Math.sin(time) * 2;
        car.rotation.y = -time;
      };

      update();
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>
